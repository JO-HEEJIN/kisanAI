<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA ë°ì´í„° ìŠ¤í† ë¦¬ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        #container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 80vh;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 50vh;
            font-size: 1.2em;
            color: #666;
        }

        .error {
            padding: 20px;
            text-align: center;
            color: #e74c3c;
            background: #ffeaea;
            border-radius: 5px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="loading">NASA ë°ì´í„° ìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <script type="module">
        // ê°„ë‹¨í•œ ê²Œì„ ì—”ì§„ ëª¨í‚¹
        const mockGameEngine = {
            getManagers: () => ({
                data: {
                    fetchSMAPData: async (type, location) => {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        return {
                            soilMoisture: 0.3 + Math.random() * 0.4,
                            temperature: 25 + Math.random() * 10,
                            coordinates: location
                        };
                    },
                    fetchNDVIData: async (location) => {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        return {
                            ndvi: 0.4 + Math.random() * 0.4,
                            coordinates: location
                        };
                    },
                    fetchPrecipitationData: async (location) => {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        return {
                            forecast: Array.from({length: 7}, (_, i) => ({
                                date: new Date(Date.now() + i * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                                precipitation: Math.random() < 0.4 ? Math.random() * 15 : 0,
                                temperature: 20 + Math.random() * 15,
                                humidity: 40 + Math.random() * 40
                            }))
                        };
                    }
                }
            })
        };

        // DataStoryInterface ì¸ë¼ì¸ ì •ì˜
        class DataStoryInterface {
            constructor(gameEngine) {
                this.gameEngine = gameEngine;
                this.container = null;
                this.currentStory = null;

                this.stories = {
                    water: {
                        title: "ğŸ’§ ë¬¼ ê´€ë¦¬ì˜ í˜ì‹ ",
                        subtitle: "SMAP í† ì–‘ìˆ˜ë¶„ ë°ì´í„°ë¡œ ë¬¼ ì‚¬ìš©ëŸ‰ 30% ì ˆì•½",
                        problem: "ì–¸ì œ ì–¼ë§ˆë‚˜ ë¬¼ì„ ì¤˜ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´ìš”",
                        solution: "ìœ„ì„±ì´ ë•…ì† ìˆ˜ë¶„ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì•Œë ¤ì¤ë‹ˆë‹¤",
                        data: "SMAP",
                        color: "#4A90E2"
                    },
                    health: {
                        title: "ğŸŒ± ì‘ë¬¼ ê±´ê°• ê´€ë¦¬",
                        subtitle: "NDVI ì‹ìƒì§€ìˆ˜ë¡œ ë³‘ì¶©í•´ ì¡°ê¸° ë°œê²¬",
                        problem: "ì‘ë¬¼ì´ ì•„í”ˆ ê±¸ ëŠ¦ê²Œ ë°œê²¬í•´ì„œ ìˆ˜í™•ëŸ‰ì´ ì¤„ì–´ìš”",
                        solution: "ìœ„ì„±ì´ ì‘ë¬¼ì˜ ê±´ê°• ìƒíƒœë¥¼ ë¯¸ë¦¬ ì•Œë ¤ì¤ë‹ˆë‹¤",
                        data: "MODIS NDVI",
                        color: "#7ED321"
                    },
                    weather: {
                        title: "ğŸŒ¦ï¸ ê¸°í›„ ëŒ€ì‘ ì „ëµ",
                        subtitle: "GPM ê°•ìˆ˜ëŸ‰ ì˜ˆì¸¡ìœ¼ë¡œ ë†ì‘ì—… ê³„íš ìµœì í™”",
                        problem: "ê°‘ì‘ìŠ¤ëŸ° ë‚ ì”¨ ë³€í™”ë¡œ ë†ì‘ì—… ê³„íšì´ ì—‰ë§ì´ì—ìš”",
                        solution: "ìœ„ì„±ì´ ì¼ì£¼ì¼ ë’¤ ë‚ ì”¨ê¹Œì§€ ì •í™•íˆ ì˜ˆì¸¡í•©ë‹ˆë‹¤",
                        data: "GPM IMERG",
                        color: "#F5A623"
                    }
                };
            }

            createInterface(container) {
                this.container = container;

                container.innerHTML = \`
                    <div style="padding: 20px;">
                        <div style="text-align: center; margin-bottom: 40px;">
                            <h1 style="font-size: 2.5em; color: #2c3e50; margin-bottom: 10px;">
                                ğŸš€ NASA ë°ì´í„°ë¡œ ë†ì—…ì´ ë°”ë€ŒëŠ” ì´ì•¼ê¸°
                            </h1>
                            <p style="font-size: 1.2em; color: #7f8c8d; max-width: 600px; margin: 0 auto;">
                                ë³µì¡í•œ ìœ„ì„± ë°ì´í„°ë¥¼ ë†ì—… í˜„ì¥ì—ì„œ ë°”ë¡œ í™œìš©í•˜ëŠ” ë°©ë²•
                            </p>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 40px;">
                            \${Object.entries(this.stories).map(([key, story]) => \`
                                <div class="story-card" data-story="\${key}" style="
                                    background: white;
                                    border-left: 5px solid \${story.color};
                                    border-radius: 10px;
                                    padding: 20px;
                                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                                    cursor: pointer;
                                    transition: transform 0.3s ease, box-shadow 0.3s ease;
                                " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 15px rgba(0,0,0,0.2)'"
                                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)'">
                                    <h3 style="font-size: 1.5em; margin-bottom: 10px;">\${story.title}</h3>
                                    <p style="color: #7f8c8d; margin-bottom: 15px;">\${story.subtitle}</p>
                                    <div style="
                                        display: flex;
                                        align-items: center;
                                        justify-content: space-between;
                                        margin: 15px 0;
                                        padding: 10px;
                                        background: #f8f9fa;
                                        border-radius: 5px;
                                    ">
                                        <div style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                            <span>âŒ</span>
                                            <span>ì „í†µ ë°©ì‹</span>
                                        </div>
                                        <div style="font-size: 1.2em; color: #3498db;">â†’</div>
                                        <div style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                            <span>âœ…</span>
                                            <span>NASA ë°©ì‹</span>
                                        </div>
                                    </div>
                                    <button style="
                                        width: 100%;
                                        padding: 12px;
                                        border: none;
                                        border-radius: 5px;
                                        background: \${story.color};
                                        color: white;
                                        font-weight: bold;
                                        cursor: pointer;
                                        transition: opacity 0.3s ease;
                                    " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                                        ì´ì•¼ê¸° ë³´ê¸°
                                    </button>
                                </div>
                            \`).join('')}
                        </div>

                        <div style="
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                            gap: 20px;
                            margin-top: 40px;
                        ">
                            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                                <h4 style="color: #2c3e50; margin-bottom: 5px;">ğŸ’° ë¹„ìš© ì ˆê°</h4>
                                <p style="font-size: 1.5em; font-weight: bold; color: #3498db;">í‰ê·  25-40%</p>
                            </div>
                            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                                <h4 style="color: #2c3e50; margin-bottom: 5px;">ğŸ“ˆ ìˆ˜í™•ëŸ‰ ì¦ê°€</h4>
                                <p style="font-size: 1.5em; font-weight: bold; color: #3498db;">í‰ê·  15-30%</p>
                            </div>
                            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                                <h4 style="color: #2c3e50; margin-bottom: 5px;">ğŸŒ í™˜ê²½ ë³´í˜¸</h4>
                                <p style="font-size: 1.5em; font-weight: bold; color: #3498db;">ë¬¼ ì‚¬ìš©ëŸ‰ 30% ê°ì†Œ</p>
                            </div>
                        </div>
                    </div>

                    <div id="storyDetail" style="display: none;">
                        <!-- ê°œë³„ ìŠ¤í† ë¦¬ ë‚´ìš©ì´ ì—¬ê¸°ì— ë“¤ì–´ê° -->
                    </div>
                \`;

                this.setupEventListeners();
            }

            setupEventListeners() {
                this.container.querySelectorAll('.story-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const storyKey = card.dataset.story;
                        this.showStoryDetail(storyKey);
                    });
                });
            }

            showStoryDetail(storyKey) {
                const story = this.stories[storyKey];
                this.currentStory = storyKey;

                const detailContainer = this.container.querySelector('#storyDetail');

                detailContainer.innerHTML = \`
                    <div style="padding: 20px;">
                        <div style="display: flex; align-items: center; margin-bottom: 30px;">
                            <button id="backButton" style="
                                background: #3498db;
                                color: white;
                                border: none;
                                padding: 10px 15px;
                                border-radius: 5px;
                                cursor: pointer;
                                margin-right: 20px;
                            ">â† ëŒì•„ê°€ê¸°</button>
                            <h2>\${story.title}</h2>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
                            <div style="padding: 20px; background: #fee; border-left: 5px solid #e74c3c; border-radius: 10px;">
                                <h3>âŒ ì „í†µ ë°©ì‹ì˜ ë¬¸ì œ</h3>
                                <p>\${story.problem}</p>
                                <div style="margin-top: 15px;">
                                    <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 5px;">
                                        ğŸŒµ ê²½í—˜ê³¼ ê°ì—ë§Œ ì˜ì¡´í•˜ëŠ” ë†ì—…
                                    </div>
                                    <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 5px;">
                                        ğŸ’¸ ë¹„íš¨ìœ¨ì ì¸ ìì› ì‚¬ìš©
                                    </div>
                                    <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 5px;">
                                        â“ ì–¸ì œ ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ëª¨ë¦„
                                    </div>
                                </div>
                            </div>

                            <div style="padding: 20px; background: #efe; border-left: 5px solid #27ae60; border-radius: 10px;">
                                <h3>âœ… NASA ë°ì´í„° í™œìš©</h3>
                                <p>\${story.solution}</p>
                                <div style="margin-top: 15px;">
                                    <div style="display: flex; align-items: flex-start; margin: 15px 0;">
                                        <span style="
                                            background: #3498db;
                                            color: white;
                                            width: 30px;
                                            height: 30px;
                                            border-radius: 50%;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            margin-right: 15px;
                                            flex-shrink: 0;
                                        ">1</span>
                                        <div>
                                            <h4 style="margin: 0 0 5px 0;">ì‹¤ì‹œê°„ ìœ„ì„± ë°ì´í„° ìˆ˜ì§‘</h4>
                                            <p style="margin: 0;">\${story.data} ìœ„ì„±ìœ¼ë¡œ ì •í™•í•œ ë°ì´í„° ì¸¡ì •</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: flex-start; margin: 15px 0;">
                                        <span style="
                                            background: #3498db;
                                            color: white;
                                            width: 30px;
                                            height: 30px;
                                            border-radius: 50%;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            margin-right: 15px;
                                            flex-shrink: 0;
                                        ">2</span>
                                        <div>
                                            <h4 style="margin: 0 0 5px 0;">AI ë¶„ì„ìœ¼ë¡œ ìµœì í™”</h4>
                                            <p style="margin: 0;">ì¸ê³µì§€ëŠ¥ì´ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ìµœì ì˜ í•´ë²• ì œì‹œ</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: flex-start; margin: 15px 0;">
                                        <span style="
                                            background: #3498db;
                                            color: white;
                                            width: 30px;
                                            height: 30px;
                                            border-radius: 50%;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            margin-right: 15px;
                                            flex-shrink: 0;
                                        ">3</span>
                                        <div>
                                            <h4 style="margin: 0 0 5px 0;">ì‹¤ì‹œê°„ ì•Œë¦¼ ë° ê°€ì´ë“œ</h4>
                                            <p style="margin: 0;">ì–¸ì œ, ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ì •í™•í•œ ê°€ì´ë“œ ì œê³µ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="
                            background: white;
                            padding: 20px;
                            border-radius: 10px;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            margin-bottom: 30px;
                        ">
                            <h3>ğŸ“Š ì‹¤ì œ ë°ì´í„° ì²´í—˜í•´ë³´ê¸°</h3>
                            <button id="loadDataBtn" style="
                                background: \${story.color};
                                color: white;
                                border: none;
                                padding: 12px 20px;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 1em;
                            ">ë‚´ ë†ì¥ ìœ„ì¹˜ì˜ NASA ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                            <div id="dataDisplay" style="margin-top: 20px;"></div>
                        </div>

                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h3>ğŸ› ï¸ ì‹¤ì œ ë†ì—… í˜„ì¥ì—ì„œ í™œìš©í•˜ê¸°</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 15px;">
                                <div style="background: white; padding: 15px; border-radius: 5px;">
                                    <h5 style="color: #2c3e50;">ğŸ“± í•„ìš”í•œ ë„êµ¬</h5>
                                    <ul style="margin: 0; padding-left: 20px;">
                                        <li>ìŠ¤ë§ˆíŠ¸í° (NASA ì•±)</li>
                                        <li>GPS ì¢Œí‘œ</li>
                                        <li>ì¸í„°ë„· ì—°ê²°</li>
                                    </ul>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 5px;">
                                    <h5 style="color: #2c3e50;">ğŸ“‹ ì‚¬ìš© ë°©ë²•</h5>
                                    <ol style="margin: 0; padding-left: 20px;">
                                        <li>ë†ì¥ ìœ„ì¹˜ ë“±ë¡</li>
                                        <li>ë°ì´í„° í™•ì¸</li>
                                        <li>AI ì¶”ì²œ í™•ì¸</li>
                                        <li>ë†ì‘ì—… ì‹¤í–‰</li>
                                    </ol>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 5px;">
                                    <h5 style="color: #2c3e50;">ğŸ’° ê²½ì œì  íš¨ê³¼</h5>
                                    <ul style="margin: 0; padding-left: 20px;">
                                        <li>ë¹„ìš© 30% ì ˆê°</li>
                                        <li>ìˆ˜í™•ëŸ‰ 20% ì¦ê°€</li>
                                        <li>6ê°œì›” ë‚´ íˆ¬ìíšŒìˆ˜</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                \`;

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                detailContainer.querySelector('#backButton').addEventListener('click', () => {
                    this.showMainScreen();
                });

                detailContainer.querySelector('#loadDataBtn').addEventListener('click', () => {
                    this.loadSampleData(storyKey);
                });

                // ë©”ì¸ í™”ë©´ ìˆ¨ê¸°ê³  ìƒì„¸ í™”ë©´ ë³´ì´ê¸°
                this.container.querySelector('div').style.display = 'none';
                detailContainer.style.display = 'block';
            }

            showMainScreen() {
                this.container.querySelector('div').style.display = 'block';
                this.container.querySelector('#storyDetail').style.display = 'none';
                this.currentStory = null;
            }

            async loadSampleData(storyKey) {
                const dataDisplay = this.container.querySelector('#dataDisplay');
                const dataManager = this.gameEngine.getManagers().data;

                dataDisplay.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">NASA ìœ„ì„± ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

                try {
                    // ìƒ˜í”Œ ìœ„ì¹˜ (ì„œìš¸)
                    const location = { latitude: 37.5665, longitude: 126.9780 };

                    if (storyKey === 'water') {
                        const data = await dataManager.fetchSMAPData('surface', location);
                        dataDisplay.innerHTML = \`
                            <div style="background: #e8f4fd; padding: 20px; border-radius: 5px; border-left: 4px solid #3498db;">
                                <h4 style="margin: 0 0 10px 0;">ğŸŒ ì„œìš¸ ì§€ì—­ í† ì–‘ìˆ˜ë¶„ ë°ì´í„°</h4>
                                <div style="font-size: 2em; font-weight: bold; color: #3498db;">\${(data.soilMoisture * 100).toFixed(1)}%</div>
                                <p style="margin: 10px 0 0 0;">í˜„ì¬ í† ì–‘ìˆ˜ë¶„ ìƒíƒœ: \${data.soilMoisture > 0.4 ? 'ì¶©ë¶„' : data.soilMoisture > 0.2 ? 'ë³´í†µ' : 'ë¶€ì¡±'}</p>
                                <p style="margin: 5px 0 0 0; font-size: 0.9em; color: #666;">
                                    ì¶”ì²œ: \${data.soilMoisture > 0.4 ? 'ê´€ê°œ ë¶ˆí•„ìš”' : '3-5ì¼ í›„ ê´€ê°œ í•„ìš”'}
                                </p>
                            </div>
                        \`;
                    } else if (storyKey === 'health') {
                        const data = await dataManager.fetchNDVIData(location);
                        const color = data.ndvi > 0.7 ? '#27ae60' : data.ndvi > 0.4 ? '#f39c12' : '#e74c3c';
                        dataDisplay.innerHTML = \`
                            <div style="background: #eef7ee; padding: 20px; border-radius: 5px; border-left: 4px solid #27ae60;">
                                <h4 style="margin: 0 0 10px 0;">ğŸŒ± ì„œìš¸ ì§€ì—­ ì‹ìƒì§€ìˆ˜ ë°ì´í„°</h4>
                                <div style="font-size: 2em; font-weight: bold; color: \${color};">\${data.ndvi.toFixed(3)}</div>
                                <p style="margin: 10px 0 0 0;">ì‘ë¬¼ ê±´ê°• ìƒíƒœ: \${data.ndvi > 0.7 ? 'ë§¤ìš° ê±´ê°•' : data.ndvi > 0.4 ? 'ë³´í†µ' : 'ì£¼ì˜ í•„ìš”'}</p>
                                <p style="margin: 5px 0 0 0; font-size: 0.9em; color: #666;">
                                    \${data.ndvi > 0.7 ? 'í˜„ì¬ ìƒíƒœ ìœ ì§€' : data.ndvi > 0.4 ? 'ê´€ì°° í•„ìš”' : 'ì¦‰ì‹œ ì ê²€ ìš”ë§'}
                                </p>
                            </div>
                        \`;
                    } else if (storyKey === 'weather') {
                        const data = await dataManager.fetchPrecipitationData(location);
                        const totalRain = data.forecast.slice(0, 7).reduce((sum, day) => sum + day.precipitation, 0);
                        dataDisplay.innerHTML = \`
                            <div style="background: #fff9e6; padding: 20px; border-radius: 5px; border-left: 4px solid #f39c12;">
                                <h4 style="margin: 0 0 10px 0;">ğŸŒ¦ï¸ ì„œìš¸ ì§€ì—­ 7ì¼ ê°•ìˆ˜ëŸ‰ ì˜ˆì¸¡</h4>
                                <div style="font-size: 2em; font-weight: bold; color: #f39c12;">\${totalRain.toFixed(1)}mm</div>
                                <p style="margin: 10px 0 0 0;">ì¼ì£¼ì¼ê°„ ì˜ˆìƒ ê°•ìˆ˜ëŸ‰</p>
                                <p style="margin: 5px 0 0 0; font-size: 0.9em; color: #666;">
                                    ì¶”ì²œ: \${totalRain > 50 ? 'ë°°ìˆ˜ë¡œ ì ê²€ í•„ìš”' : totalRain < 5 ? 'ê´€ê°œ ê³„íš ìˆ˜ë¦½' : 'ë†ì‘ì—… ì í•©'}
                                </p>
                            </div>
                        \`;
                    }
                } catch (error) {
                    dataDisplay.innerHTML = \`
                        <div style="background: #ffeaea; padding: 20px; border-radius: 5px; border-left: 4px solid #e74c3c;">
                            <p style="margin: 0; color: #e74c3c;">âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: \${error.message}</p>
                        </div>
                    \`;
                }
            }
        }

        // ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™”
        try {
            const container = document.getElementById('container');
            const storyInterface = new DataStoryInterface(mockGameEngine);

            // ë¡œë”© ì œê±°í•˜ê³  ì¸í„°í˜ì´ìŠ¤ í‘œì‹œ
            setTimeout(() => {
                storyInterface.createInterface(container);
            }, 500);

        } catch (error) {
            console.error('Error:', error);
            document.getElementById('container').innerHTML = \`
                <div class="error">
                    <h3>ì´ˆê¸°í™” ì˜¤ë¥˜</h3>
                    <p>\${error.message}</p>
                    <button onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
                </div>
            \`;
        }
    </script>
</body>
</html>